<!--Image processing. Start.-->
<style>
    button{
        border: none;
        background-color: white;
        cursor: pointer;
    }
    p{
        margin: 5px 0;
    }
</style>
<canvas id="canvasEdit" width="10" height="10" >Canvas</canvas>
<p>Click on the button to change the color... <button id="colorToggle" class="black">BLACK</button></p>
<script>
const canvas = document.getElementById("canvasEdit"), 
    width = canvas.width,
    height = canvas.height,       
    ctx = canvas.getContext("2d");
    /*draw a picture*/
    ctx.fillRect(0,0,10,10);
    /*get data*/
const imgGetCanvas = ctx.getImageData(0, 0, width, height),
    /*1 variant -*/
    pixelsUint8ClampedArray = imgGetCanvas.data,
    /*2 variant +*/
    pixelsUint32Array = new Uint32Array(imgGetCanvas.data.buffer);  
/*toggle RED BLACK*/
let colorToggle = document.getElementById("colorToggle");
    colorToggle.addEventListener("click", function () {
        if (colorToggle.classList.contains("red")) {
            colorToggle.innerHTML = "BLACK";
            colorToggle.className = "black";
            colorToggle.style.color = "black";
        } else {
            colorToggle.innerHTML = "RED";
            colorToggle.className = "red";
            colorToggle.style.color = "red";
        }
    for (let y = 0; y < height; y++) {
     for (let x = 0; x < width; x++) {
     let index = (y * width + x) * 4,
        r = pixelsUint8ClampedArray[index],//red
        g = pixelsUint8ClampedArray[index+1],//green
        b = pixelsUint8ClampedArray[index+2],//blue
        a = pixelsUint8ClampedArray[index+3],//alfa
         rgba = r+","+g+","+b+","+a;
        if (rgba == "0,0,0,255") {
            /*red 255,0,0,255*/
            pixelsUint8ClampedArray[index]= 255;//red
            pixelsUint8ClampedArray[index+1]= 0;//green
            pixelsUint8ClampedArray[index+2]= 0;//blue
            pixelsUint8ClampedArray[index+3]= 255;//alfa
            console.log("Color black "+rgba);
        }else{
            /*black 0,0,0,255*/
            pixelsUint8ClampedArray[index]= 0;//red
            pixelsUint8ClampedArray[index+1]= 0;//green
            pixelsUint8ClampedArray[index+2]= 0;//blue
            pixelsUint8ClampedArray[index+3]= 255;//alfa
            console.log("Color red "+rgba);
        }
     }
    }
    ctx.putImageData(imgGetCanvas, 0, 0);
    })
</script>

<!--Images. Simple transformation.-->
<canvas id="canvasImagenRotate">Canvas Imagen</canvas>
<p>Click on the button to change the image... <button id="colorToggleImagen" class="colorToggleImagen">Rotate 0째</button></p>
<script>
    const canvasImagen = document.getElementById("canvasImagenRotate"),
          img = new Image(),
          ctxImagen = canvasImagen.getContext("2d");
          img.onload = function (){
            canvasImagen.width = img.width;
            canvasImagen.height = img.height;
            ctxImagen.drawImage(img, 0, 0);
            /*get data*/
            const width = canvasImagen.width,
                  height = canvasImagen.height,                
                  imgGetCanvas = ctxImagen.getImageData(0, 0, width, height),
                  /*2 variant +*/
                  pixelsUint32Array = new Uint32Array(imgGetCanvas.data.buffer),
                  src = new Uint32Array(imgGetCanvas.data.buffer),
                  colorToggleImagen = document.getElementById("colorToggleImagen");
                 
            colorToggleImagen.addEventListener("click",function () {
                colorToggleImagen.classList.toggle("activ");
                if (colorToggleImagen.className == "colorToggleImagen activ") {
                    // Rotate 90째
                    let newWidth = height;
                    let newHeight = width;
                    canvasImagen.width = newWidth;
                    canvasImagen.height = newHeight;
                    for (let y = 0; y < newHeight; y++) {
                      for (let x = 0; x < newWidth; x++) {
                        pixelsUint32Array[y * newWidth + x] = src[(height - x - 1) * width + y];
                      }
                    }
                    ctxImagen.putImageData(imgGetCanvas, 0, 0);
                    colorToggleImagen.innerHTML = "Rotate 90째";
                } else {
                    ctxImagen.drawImage(img, 0, 0);
                    colorToggleImagen.innerHTML = "Rotate 0째";
                }
            })
          }
          img.src = "./favicon.png";

</script>

<!--Images. Simple scale.-->
<canvas id="canvasImagenScale"></canvas>
<p>Choose image scale from 1 to 5... <input type="range" name="scale" id="scale" min="1" max="5" step="1" value="1" list="marker"><output id="value"></output></p>
<datalist id="marker">
    <option value="1"></option>
    <option value="2"></option>
    <option value="3"></option>
    <option value="4"></option>
    <option value="5"></option>
  </datalist>
<script>

let imgScale = new Image(),
    scale = document.getElementById("scale"),
    value = document.getElementById("value"),
    canvasImagenScale = document.getElementById("canvasImagenScale"),
    ctxScale = canvasImagenScale.getContext("2d"),
    scaleImegen = 1;
    value.textContent = scale.value;       
    imgScale.src = "./favicon.png";
    imgScale.onload = function () {
        scaleImagen(imgScale,scaleImegen);    
    }
    

   
  scale.addEventListener("input",function () {
        value.textContent = scale.value;       
        scaleImegen = scale.value;
        scaleImagen(imgScale,scaleImegen);      
  })

function scaleImagen(img, scale) {    
    var widthScaled = img.width * scale;
    var heightScaled = img.height * scale;
        canvasImagenScale.width = widthScaled;
        canvasImagenScale.height = heightScaled;    
        
    var orig = document.createElement('canvas');
    orig.width = img.width;
    orig.height = img.height;
    var origCtx = orig.getContext('2d');
    origCtx.drawImage(img, 0, 0);
    var origPixels = origCtx.getImageData(0, 0, img.width, img.height);

    var scaled = document.createElement('canvas');
    scaled.width = widthScaled;
    scaled.height = heightScaled;
    var scaledCtx = scaled.getContext('2d');
    var scaledPixels = scaledCtx.getImageData( 0, 0, widthScaled, heightScaled );

    for( var y = 0; y < heightScaled; y++ ) {
        for( var x = 0; x < widthScaled; x++ ) {
            var index = (Math.floor(y / scale) * img.width + Math.floor(x / scale)) * 4;
            var indexScaled = (y * widthScaled + x) * 4;
            scaledPixels.data[ indexScaled ] = origPixels.data[ index ];
            scaledPixels.data[ indexScaled+1 ] = origPixels.data[ index+1 ];
            scaledPixels.data[ indexScaled+2 ] = origPixels.data[ index+2 ];
            scaledPixels.data[ indexScaled+3 ] = origPixels.data[ index+3 ];
        }
    }
    ctxScale.putImageData(scaledPixels, 0, 0);
}

</script>
