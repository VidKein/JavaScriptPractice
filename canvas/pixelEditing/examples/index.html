<style>
    p{margin: 2px 0;}
    h3{margin: 2px 0;}
    .fotoBlock{
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      justify-content: center;
    }
    #canvasEdihion{
      margin: auto;
      height: 200px;
    }
    .histogram{
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }
    .editFoto{
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
    }
    input[type = "number"]{
      width: 72px;
    }
</style>
<div class="fotoBlock">
  <canvas id="canvasEdihion"></canvas>

      <div class="histogram">
        <p>Histogram</p>
        <label>
          <input name="rType" type="radio" id="typeValue"  checked/> Black-white
        </label>
        <label>
          <input name="rType" type="radio" /> Color
        </label>        
      
      <canvas id="canvasHistogram" width="256" height="150"></canvas>
    </div>
</div>



<div class="editFoto">

<div class="editFotoPixels">
  <h3>Edit Foto Pixels</h3>
    <p>Brightness</p>
    <div>
      <label>
        <input id="rangeBrightness" name = "range" type="range" min="-255" max="255" value="0" />
        <span id="valueBrightness">0</span>
      </label>
    </div>
    <p>Contrast</p>
    <div>
      <label>
        <input id="rangeContrast" name = "range" type="range" min="-255" max="255" value="" />
        <span id="valueContrast">0</span>
      </label>
    </div>
    <p>Saturation</p>
    <div>
      <label>
        <input id="rangeSaturation" type="range"  name="range" min="-255" max="255" value="0" />
        <span id="valueSaturation">0</span>                
      </label>  
    </div>
    <p>Sharp</p>
    <div>
      <label>
        <input id="rangeSharp" type="range"  name="range" min="0.1" max="100" step="0.01" value="0" />
        <span id="valueSharp">0</span>                
      </label>  
    </div>
    <p>Resize:</p>
                <div id="inputScale">
                <input id="numWidth" type="number" name="rangeScale" value=""/>x<input class="closet" id="numHeight" type="number" name="rangeScale" value="" disabled/>
                </div>
                <div>
                  <label>
                    <input id="cbProportions" type="checkbox" checked/>Proportions
                  </label>
                </div>
                <div>
                  <p>Scale methods:</p>
                  <select name="scaleVersion" id="scaleVersion" size="1">
                    <option value="neighbor" selected>Nearest neighbor scaling</option>
                    <option value="bilinear">Bilinear scaling</option>
                    <option value="lanczos">Lanczos scaling</option>
                  </select>    
                </div>
  </div>

<div class="editFotoMethods">
    <h3>Edit foto using methods</h3>
    <p>Rotate</p>
    <div class="radioBlock" id="radioBlock">
      <p><input type="radio" name="rotate" id="0" min="0" value="0" title="rotate 0deg" checked> - 0&#176;</p>
      <p><input type="radio" name="rotate" id="90l" value="90" title="rotate 90deg left"> - 90&#176;</p>
      <p><input type="radio" name="rotate" id="90r" value="-90" title="rotate 90deg right"> - 270&#176;</p>
      <p><input type="radio" name="rotate" id="180" value="180" title="rotate 180deg left"> - 180&#176;</p>
      <p><input type="radio" name="rotate" id="flip" value="270" title="mirror reflection"> - mirror</p>
      <p><input type="radio" name="rotate" id="arbitrary" value="arbitrary" title="arbitrary"> - <input type="number" name="degrees" id="degrees" placeholder="&#177;0-90&#176;" value="0" minlength="1" maxlength="3" min="-90"  max="90" disabled></p>
    </div>
</div>

<div class="Effect">
  <button type="button" class="accordion">Effects 1</button>
  <div class="effects"><p>Negative effect</p></div>                                
  <button type="button" class="accordion">Effects 2</button>
  <div class="effects"><p>Discoloration (black and white)</p></div>
  <button type="button" class="accordion">Effects 3</button>
  <div class="effects"><p>RGB correction</p></div>
  <button type="button" class="accordion">Effects 4</button>
  <div class="effects"><p>HSL correction</p></div>
  <button type="button" class="accordion">Effects 5</button>
  <div class="effects"><p>Gamma correction</p></div>
  <button type="button" class="accordion">Effects 6</button>
  <div class="effects"><p>Blur 1</p></div>
  <button type="button" class="accordion">Effects 7</button>
  <div class="effects"><p>Blur 2</p></div>
</div>  

</div>
<script>
/*Загружаем изображение*/
    let img = new Image();
        img.onload = update;
        img.src = "./kiza.jpeg";

/*Данные для редоктирования*/
let input = document.getElementsByName("range"),
    rangeBrightness = document.getElementById("rangeBrightness"),
    rangeContrast = document.getElementById("rangeContrast"),
    rangeSaturation = document.getElementById("rangeSaturation"),
    rangeSharp = document.getElementById("rangeSharp");
    
/*Редоктируем canvas*/
function editCanvas(inImagen) {
  const width = inImagen.width,
        height = inImagen.height,
        src = new Uint32Array(inImagen.data.buffer);
  //Изменяем canvas      
  //src - пиксельная информация canvas
  //dst - болванка для проведения изменений
 updateCanvasPixel(width, height , function(dst) {
      let brightness = parseInt(rangeBrightness.value), 
          contrast = parseInt(rangeContrast.value)/255,
          saturation = parseInt(rangeSaturation.value),
          maxSaturation = (saturation < 0) ? 255 :128,
          sharp = parseInt(rangeSharp.value); 
          
    //
    let avgGray = 0;
      for (let i = 0; i < dst.length; i++) {
        let r = src[i] & 0xFF;
        let g = (src[i] >> 8) & 0xFF;
        let b = (src[i] >> 16) & 0xFF;
        avgGray += (r * 0.2126 + g * 0.7152 + b * 0.0722);
      }
      avgGray /= dst.length;
      
      for (let i = 0; i < dst.length; i++) {
        let r = src[i] & 0xFF;
        let g = (src[i] >> 8) & 0xFF;
        let b = (src[i] >> 16) & 0xFF;
        
        // Contrast
        r += (r - avgGray) * contrast;
        g += (g - avgGray) * contrast;
        b += (b - avgGray) * contrast;
        // Brightness
        r += brightness;
        g += brightness;
        b += brightness;
        
        if (r > 255) r = 255;
        else if (r < 0) r = 0;
        if (g > 255) g = 255;
        else if (g < 0) g = 0;
        if (b > 255) b = 255;
        else if (b < 0) b = 0;
        
        dst[i] = (src[i] & 0xFF000000) | (b << 16) | (g << 8) | r;
      }      
      histogram(dst); //Histogram 
  });

}

//Гистограмма
function histogram(dst) {
  //переключаем отображения гистограммы
  const isValueHistogram = document.getElementById('typeValue').checked; 
    let histBrightness = (new Array(256)).fill(0);
    let histR = (new Array(256)).fill(0);
    let histG = (new Array(256)).fill(0);
    let histB = (new Array(256)).fill(0);
    for (let i = 0; i < dst.length; i++) {
      let r = dst[i] & 0xFF;
      let g = (dst[i] >> 8) & 0xFF;
      let b = (dst[i] >> 16) & 0xFF;
      histBrightness[r]++;
      histBrightness[g]++;
      histBrightness[b]++;
      histR[r]++;
      histG[g]++;
      histB[b]++;
    }
    
    let maxBrightness = 0;
    if (isValueHistogram) {
      for (let i = 1; i < 256; i++) {
        if (maxBrightness < histBrightness[i]) {
          maxBrightness = histBrightness[i]
        }
      }
    } else {
      for (let i = 0; i < 256; i++) {
        if (maxBrightness < histR[i]) {
          maxBrightness = histR[i]
        } else if (maxBrightness < histG[i]) {
          maxBrightness = histG[i]
        } else if (maxBrightness < histB[i]) {
          maxBrightness = histB[i]
        }
      }
    }
    
    const canvas = document.getElementById('canvasHistogram');
    const ctx = canvas.getContext('2d');
    let guideHeight = 8;
    let startY = (canvas.height - guideHeight);
    let dx = canvas.width / 256;
    let dy = startY / maxBrightness;
    ctx.lineWidth = dx;
    ctx.fillStyle = "#fff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    for (let i = 0; i < 256; i++) {
      let x = i * dx;
      if (isValueHistogram) {
        // Value
        ctx.strokeStyle = "#000000";
        ctx.beginPath();
        ctx.moveTo(x, startY);
        ctx.lineTo(x, startY - histBrightness[i] * dy);
        ctx.closePath();
        ctx.stroke(); 
      } else {
        // Red
        ctx.strokeStyle = "rgba(220,0,0,0.5)";
        ctx.beginPath();
        ctx.moveTo(x, startY);
        ctx.lineTo(x, startY - histR[i] * dy);
        ctx.closePath();
        ctx.stroke(); 
        // Green
        ctx.strokeStyle = "rgba(0,210,0,0.5)";
        ctx.beginPath();
        ctx.moveTo(x, startY);
        ctx.lineTo(x, startY - histG[i] * dy);
        ctx.closePath();
        ctx.stroke(); 
        // Blue
        ctx.strokeStyle = "rgba(0,0,255,0.5)";
        ctx.beginPath();
        ctx.moveTo(x, startY);
        ctx.lineTo(x, startY - histB[i] * dy);
        ctx.closePath();
        ctx.stroke(); 
      }
      // Guide
      ctx.strokeStyle = 'rgb(' + i + ', ' + i + ', ' + i + ')';
      ctx.beginPath();
      ctx.moveTo(x, startY);
      ctx.lineTo(x, canvas.height);
      ctx.closePath();
      ctx.stroke(); 
    }
}

//переключатель для гистограммы ч-б/цветное
let switchHistogram = document.getElementsByName("rType");
for (let i = 0; i < switchHistogram.length; i++) { 
  switchHistogram[i].addEventListener('change',()=>{  
    update(switchHistogram[i]);  
  });
}

/*Выводим картнку + копируем информацию о картинке*/
function getImageData() {
  //Создаем поле для Canvas           
  const canvas = document.getElementById("canvasEdihion");
  const ctx = canvas.getContext("2d");    
  canvas.width = img.width;
  canvas.height = img.height;
  //выводим конвас
  ctx.drawImage(img, 0, 0); 
  //Передаем информацию в функцию для редоктирования картинки    
  return ctx.getImageData(0, 0, img.width, img.height);
  
}

/*Вносим изменения в canvas*/
function updateCanvasPixel(width, height, func) {
  const canvas = document.getElementById("canvasEdihion");
  canvas.width = width;
  canvas.height = height;
  const ctx = canvas.getContext("2d");
 const outImagen = ctx.createImageData(width,height);
  const dst = new Uint32Array(outImagen.data.buffer);
  func(dst);
  ctx.putImageData(outImagen, 0,0);
}

/*Старт*/

function update() {
  editCanvas(getImageData());
}

</script>